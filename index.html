<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Diamond Obfuscator – IronBrew Style</title>
<style>
  :root{
    --bg:#0b1020;
    --panel:#0f1730;
    --panel-2:#0c142a;
    --ink:#eaf2ff;
    --accent:#49a9ff;
    --accent-2:#8ad0ff;
    --muted:#9fb6d1;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background: radial-gradient(1200px 600px at -10% -10%, #10224a 0%, transparent 60%),
                radial-gradient(1200px 600px at 110% 110%, #10224a 0%, transparent 60%),
                var(--bg);
    color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    min-height:100svh;
    display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .wrap{
    width:min(1100px, 96vw);
  }
  .hero{
    display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    margin-bottom:16px;
  }
  .title{
    font-weight:900; letter-spacing:0.5px;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    font-size: clamp(28px, 5vw, 44px);
    margin:0;
  }
  .sub{color:var(--muted); margin-top:4px}
  .card{
    background: linear-gradient(180deg, var(--panel), var(--panel-2));
    border:1px solid rgba(255,255,255,.06);
    border-radius:16px; padding:16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
  }
  textarea{
    width:100%; min-height:220px; resize:vertical;
    background:#0b1329; color:#dff1ff;
    border:1px solid rgba(255,255,255,.08);
    border-radius:12px; padding:14px; font-size:14px; line-height:1.4;
    outline:none; box-shadow: inset 0 0 0 9999px rgba(255,255,255,0);
  }
  .row{display:flex; gap:12px; flex-wrap:wrap; margin-top:12px}
  .btn{
    appearance:none; border:none; cursor:pointer;
    background: linear-gradient(180deg, #2a7be9, #1156c9);
    color:white; padding:12px 16px; border-radius:12px; font-weight:700;
    box-shadow: 0 8px 20px rgba(35,124,255,.35), inset 0 1px 0 rgba(255,255,255,.15);
    transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
  }
  .btn:hover{ transform: translateY(-1px); filter: brightness(1.03) }
  .btn:active{ transform: translateY(0) scale(.99) }
  .btn.secondary{
    background: linear-gradient(180deg, #1e2a44, #162036);
    color:#cfe4ff;
    box-shadow: 0 6px 16px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,.06);
  }
  .hint{font-size:12px; color:#89a6c4}
  .grid{display:grid; gap:16px; grid-template-columns: 1fr; }
  @media(min-width:980px){ .grid{ grid-template-columns: 1fr 1fr } }
  .chip{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    background:rgba(73,169,255,.14); color:#bfe0ff; border:1px solid rgba(73,169,255,.25);
    font-size:12px; font-weight:700;
  }
  .switch{
    display:inline-flex; align-items:center; gap:8px; user-select:none; cursor:pointer; color:#cfe4ff;
  }
  .switch input{ display:none }
  .toggle{
    width:44px; height:26px; background:#16233e; border:1px solid rgba(255,255,255,.08);
    border-radius:999px; position:relative;
    box-shadow: inset 0 6px 14px rgba(0,0,0,.35);
  }
  .toggle::after{
    content:""; position:absolute; top:2px; left:2px; width:22px; height:22px; border-radius:50%;
    background: linear-gradient(180deg,#eaf2ff,#b9d3ff);
    box-shadow: 0 4px 10px rgba(0,0,0,.4);
    transition:left .18s ease;
  }
  .switch input:checked + .toggle::after{ left:20px }
  .footer{ margin-top:14px; color:#89a6c4; font-size:12px; text-align:right }
  code{ color:#bfe0ff }
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div>
        <h1 class="title">Diamond Obfuscator</h1>
        <div class="sub">IronBrew-style, browser-only obfuscation. No uploads. No servers.</div>
      </div>
      <span class="chip">Client-Side • One-Line Output • Number Encoding</span>
    </div>

    <div class="grid">
      <!-- INPUT -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Input Lua/Luau</strong>
          <label class="switch" title="If enabled, output is a single line">
            <input id="singleLine" type="checkbox" checked />
            <span class="toggle"></span> single-line
          </label>
        </div>
        <textarea id="in" spellcheck="false" placeholder='-- Paste your Lua/Luau here
print("hello world")'></textarea>
        <div class="row">
          <button class="btn" id="obfBtn">Obfuscate</button>
          <button class="btn secondary" id="exampleBtn" title="Insert a tiny sample script">Load Example</button>
          <span class="hint">Header will be added: <code>--[[obfed by Diamond obfuscator -iron brew copy]]</code></span>
        </div>
      </div>

      <!-- OUTPUT -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Output</strong>
          <span class="hint">Size depends on your code length.</span>
        </div>
        <textarea id="out" spellcheck="false" placeholder="Obfuscated code appears here…" readonly></textarea>
        <div class="row">
          <button class="btn" id="copyBtn">Copy</button>
          <button class="btn" id="downloadBtn">Download</button>
        </div>
        <div class="footer">Made with ♥ for browser use. No external services required.</div>
      </div>
    </div>
  </div>

<script>
/* -----------------------------------------------------------
   Diamond Obfuscator – IronBrew-style (client-side)
   NOTE: This is an independent re-implementation inspired by
   the “number-encoded payload with loader” pattern. It is NOT
   IronBrew’s original algorithm.
----------------------------------------------------------- */

/* Utility: UTF-8 to bytes (keeps Roblox-safe behavior) */
function toBytes(str){
  const out = [];
  for (let i=0;i<str.length;i++){
    let c = str.charCodeAt(i);
    if (c <= 0x7F){
      out.push(c);
    } else if (c <= 0x7FF){
      out.push(0xC0 | (c>>6), 0x80 | (c & 0x3F));
    } else if (c >= 0xD800 && c <= 0xDBFF){
      // surrogate pair
      const hi = c;
      const lo = str.charCodeAt(++i);
      const cp = (hi - 0xD800) * 0x400 + (lo - 0xDC00) + 0x10000;
      out.push(0xF0 | (cp>>18),
               0x80 | ((cp>>12) & 0x3F),
               0x80 | ((cp>>6) & 0x3F),
               0x80 | (cp & 0x3F));
    } else {
      out.push(0xE0 | (c>>12),
               0x80 | ((c>>6) & 0x3F),
               0x80 | (c & 0x3F));
    }
  }
  return out;
}

/* Small helpers to make the loader a little more complex */
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function rndIdent(len=randInt(6,10)){
  const a = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let s=""; for(let i=0;i<len;i++) s+=a[Math.floor(Math.random()*a.length)];
  return s;
}
function chunkArray(arr, size){
  const out=[]; for(let i=0;i<arr.length;i+=size) out.push(arr.slice(i,i+size));
  return out;
}

/* The generator: build a layered Lua one-liner with number payload */
function generateObfuscatedLua(src, opts={singleLine:true}){
  // 1) Header (exact line requested)
  const header = "--[[obfed by Diamond obfuscator -iron brew copy]]";

  // 2) Bytes + simple XOR for light obfuscation (fast, reversible)
  const key = randInt(7, 251); // avoid 0/255
  const bytes = toBytes(src).map(b => (b ^ key));

  // 3) Split into chunks to reduce extremely long bracket lists
  const chunkSize = 512; // tune for speed/size
  const chunks = chunkArray(bytes, chunkSize);

  // 4) Random identifiers to avoid pattern-based detection
  const id_tbl = rndIdent();
  const id_key = rndIdent();
  const id_cat = rndIdent();
  const id_chr = rndIdent();
  const id_lstr = rndIdent();
  const id_fake = rndIdent();
  const id_fake2 = rndIdent();

  // 5) Build chunk tables
  const tablesLua = chunks.map((c,i)=>{
    return `local ${id_tbl}${i}={${c.join(",")}}`;
  }).join(";");

  // 6) Assembly loop: reconstruct string in parts (table.concat)
  const concatParts = chunks.map((_,i)=>`${id_tbl}${i}`).join(",");
  const buildScript =
  `local ${id_key}=${key};` +
  `local ${id_cat}={${concatParts}};` +
  `local ${id_chr}=string.char;` +
  `local ${id_lstr}="";` +
  `do ` +
  ` for _i=1,#${id_cat} do ` +
  `  local _t=${id_cat}[_i]; ` +
  `  for _j=1,#_t do ` +
  `    _t[_j]=_t[_j]~${id_key}; ` +         // XOR back
  `  end; ` +
  `  ${id_lstr}=${id_lstr}..${id_chr}(table.unpack(_t)); ` +
  ` end; ` +
  `end;`;

  // 7) Light fake noise layers (valid, cheap)
  const fakeNoise =
    `do local ${id_fake}=${randInt(1000,9999)}; ` +
    `for _=1,${randInt(2,4)} do ${id_fake}=${id_fake}+1 end; end;` +
    `do local ${id_fake2}=${randInt(2000,9999)}; ` +
    `for _=1,${randInt(2,3)} do ${id_fake2}=${id_fake2}-${randInt(1,3)} end; end;`;

  // 8) Loader (loadstring) – kept simple & compatible
  const loader = `return (loadstring(${id_lstr}))()`;

  // 9) Combine everything
  let pretty =
`${header}
do ${fakeNoise}
${tablesLua}
${buildScript}
${loader} end`;

  if (opts.singleLine){
    // squash whitespace to one line
    pretty = pretty
      .replace(/\s+/g,' ')
      .replace(/;\s+/g,';')
      .replace(/\s+end/g,' end')
      .trim();
  }
  return pretty;
}

/* UI wiring */
const $in = document.getElementById('in');
const $out = document.getElementById('out');
const $obf = document.getElementById('obfBtn');
const $copy = document.getElementById('copyBtn');
const $dl = document.getElementById('downloadBtn');
const $ex = document.getElementById('exampleBtn');
const $single = document.getElementById('singleLine');

$ex.addEventListener('click', ()=>{
  $in.value = `-- tiny sample
local msg = "hello"
print("demo:", msg)
`;
});

$obf.addEventListener('click', ()=>{
  const src = $in.value || "";
  if (!src.trim()){ alert("Paste some Lua/Luau first."); return; }
  // IMPORTANT: we do NOT rename identifiers to avoid breaking scripts
  const out = generateObfuscatedLua(src, { singleLine: $single.checked });
  $out.value = out;
});

$copy.addEventListener('click', ()=>{
  if (!$out.value) return;
  $out.select();
  $out.setSelectionRange(0, 1e9);
  document.execCommand('copy');
});

$dl.addEventListener('click', ()=>{
  if (!$out.value){ alert("Nothing to download yet."); return; }
  const blob = new Blob([$out.value], {type:'text/plain'});
  const a = document.createElement('a');
  const rand = Math.floor(Math.random()*1e6);
  a.href = URL.createObjectURL(blob);
  a.download = `diamond_obf_${Date.now()}_${rand}.lua`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(a.href), 5000);
});
</script>
</body>
</html>
