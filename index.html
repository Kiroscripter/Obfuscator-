<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Diamond Obfuscator (Luau)</title>
<style>
  :root{
    --bg:#071023; --panel:#09142a; --accent:#2fb7ff; --text:#e6f7ff;
    --muted:#9fbfda; --btn:#0b84d6;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    background:
      radial-gradient(800px 400px at -10% -10%, rgba(47,183,255,0.06), transparent 20%),
      radial-gradient(900px 500px at 110% 110%, rgba(47,183,255,0.04), transparent 20%),
      var(--bg);
    color:var(--text); padding:28px;
  }
  .wrap{ width:min(1080px,98vw) }
  header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:14px }
  h1{
    margin:0; font-weight:800; font-size:clamp(20px,3.4vw,34px);
    background: linear-gradient(90deg,var(--accent),#8fe7ff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    text-shadow:0 6px 28px rgba(15,86,120,0.12);
  }
  .sub{ color:var(--muted); font-size:13px }
  .grid{ display:grid; gap:14px; grid-template-columns:1fr 460px }
  @media(max-width:980px){ .grid{ grid-template-columns:1fr } }
  .card{
    background:linear-gradient(180deg,var(--panel), #071225);
    border-radius:12px; padding:14px; border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  }
  label.switch{ display:inline-flex; gap:10px; align-items:center; cursor:pointer; color:var(--muted) }
  input[type="checkbox"]{ width:18px; height:18px }
  textarea{
    width:100%; min-height:260px; resize:vertical; background:#041226; color:#dff6ff;
    border-radius:8px; border:1px solid rgba(255,255,255,0.04); padding:12px; font-family:monospace;
    font-size:13px; line-height:1.4;
  }
  .row{ display:flex; gap:10px; align-items:center; margin-top:12px; flex-wrap:wrap }
  .btn{
    background:linear-gradient(180deg,var(--btn),#0a6ab5); color:#fff; border:none; padding:10px 14px;
    border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 8px 20px rgba(11,104,170,0.18);
  }
  .btn.secondary{ background:linear-gradient(180deg,#0e2338,#071226); color:var(--muted); border:1px solid rgba(255,255,255,0.02) }
  .hint{ color:var(--muted); font-size:12px }
  pre.output{ white-space:pre-wrap; word-break:break-all; max-height:520px; overflow:auto; padding:10px; background:#021122; border-radius:8px; border:1px solid rgba(255,255,255,0.02); color:#c8f1ff; font-family:monospace; font-size:13px }
  footer{ margin-top:10px; text-align:right; color:var(--muted); font-size:12px }
  .small{ font-size:12px; color:var(--muted) }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Diamond Obfuscator</h1>
        <div class="sub">Layered, Luau-safe obfuscation (IronBrew style) — client side</div>
      </div>
      <div class="small">--[[obfed by Diamond obfuscator - ironbrew style]]</div>
    </header>

    <div class="grid">
      <!-- LEFT: INPUT -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Input (Luau)</strong>
          <div class="small">Paste & obfuscate locally — no server</div>
        </div>

        <textarea id="inputArea" placeholder="Paste your Luau code here... (e.g. print('hello'))"></textarea>

        <div class="row" style="margin-top:10px">
          <button class="btn" id="obfBtn">Obfuscate</button>
          <button class="btn secondary" id="exampleBtn" title="Load tiny example">Load Example</button>
          <label class="switch" title="Output single-line compact">
            <input type="checkbox" id="oneLineChk"> One Liner
          </label>
          <label class="switch" title="Also compress whitespace in inner layers">
            <input type="checkbox" id="compactInner" checked> Compact Inner
          </label>
          <label class="switch" title="Force execution even if a layer fails">
            <input type="checkbox" id="safeModeChk" checked> Safe Mode
          </label>
        </div>

        <div class="row" style="margin-top:8px;align-items:center">
          <div class="hint">Layers:</div>
          <select id="layerCount" style="padding:6px;border-radius:8px;background:#081426;color:#dff6ff;border:1px solid rgba(255,255,255,0.03)">
            <option value="1">1 (fast)</option>
            <option value="2">2</option>
            <option value="3" selected>3 (recommended)</option>
            <option value="4">4</option>
            <option value="5">5 (messy)</option>
          </select>
          <div style="flex:1"></div>
          <div class="hint">Output size will increase with layers</div>
        </div>
      </div>

      <!-- RIGHT: OUTPUT -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Output</strong>
          <div class="small">Luau-safe — uses <code>bit32.bxor</code> + <code>loadstring</code></div>
        </div>

        <pre id="outArea" class="output" readonly></pre>

        <div class="row" style="margin-top:10px">
          <button class="btn" id="copyBtn">Copy</button>
          <button class="btn" id="downloadBtn">Download</button>
        </div>

        <div style="margin-top:10px" class="small hint">
          Safe Mode ensures execution continues even if one decode layer errors, like IronBrew redundancy.
        </div>
      </div>
    </div>

    <footer>Made with care — Diamond Obfuscator (Luau) • Local only</footer>
  </div>

<script>
function rndId(len=8){
  const letters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let s="";
  for(let i=0;i<len;i++) s+=letters.charAt(Math.floor(Math.random()*letters.length));
  return s;
}
function toBytesUtf8(str){
  const out=[];
  for(let i=0;i<str.length;i++){
    let c = str.charCodeAt(i);
    if(c<=0x7F) out.push(c);
    else if(c<=0x7FF){
      out.push(0xC0 | (c>>6), 0x80 | (c&0x3F));
    } else if(c>=0xD800 && c<=0xDBFF){
      const hi=c; const lo=str.charCodeAt(++i);
      const cp = (hi-0xD800)*0x400 + (lo-0xDC00) + 0x10000;
      out.push(0xF0 | (cp>>18), 0x80 | ((cp>>12)&0x3F), 0x80 | ((cp>>6)&0x3F), 0x80 | (cp&0x3F));
    } else {
      out.push(0xE0 | (c>>12), 0x80 | ((c>>6)&0x3F), 0x80 | (c&0x3F));
    }
  }
  return out;
}
function joinNums(arr){ return arr.join(","); }
function encodeNumbersFromString(str, key){
  const bytes = toBytesUtf8(str);
  return bytes.map(b => (b ^ key) & 0xFF);
}
function compactText(s){ return s.replace(/\s+/g," ").trim(); }
function buildLayerLua(payloadStr, key, opts){
  const nums = encodeNumbersFromString(payloadStr, key);
  const tblName = rndId(6);
  const tmpName = rndId(6);
  const sbits = joinNums(nums);
  let layer =
`(function()
local ${tblName} = {${sbits}}
for i=1,#${tblName} do ${tblName}[i] = bit32.bxor(${tblName}[i], ${key}) end
local ${tmpName} = ""
for i=1,#${tblName} do ${tmpName} = ${tmpName} .. string.char(${tblName}[i]) end
return ${tmpName}
end)()`;
  if (opts && opts.compact) layer = compactText(layer);
  return layer;
}
function makeJunkBlock(){
  const fn = rndId(6);
  const a = Math.floor(Math.random()*4000)+100;
  const b = Math.floor(Math.random()*4000)+200;
  const c = Math.floor(Math.random()*100)+1;
  return `do local ${fn} = ${a} + ${b}; ${fn} = bit32.bxor(${fn}, ${c}); end`;
}
function generateObfuscated(scriptText, layers=3, oneLine=false, compactInner=true, safeMode=true){
  const junkComment = `--[[JUNK:${Math.random().toString(36).slice(2,10)}]]\n`;
  let current = junkComment + scriptText;
  for(let i=0;i<layers;i++){
    const key = Math.floor(Math.random()*200)+11;
    current = buildLayerLua(current, key, {compact: compactInner});
  }
  const helperName = rndId(6);
  const runFunName = rndId(6);
  let finalLua = `
--[[obfed by Diamond obfuscator - ironbrew style]]
(function()
  ${makeJunkBlock()}
  local function ${runFunName}(s)
    local ok,f = pcall(loadstring, s)
    if ok and type(f)=="function" then
      local suc,res = pcall(f)
      if suc and type(res)=="string" then return res,true
      elseif suc then return res,false end
    end
    return nil,false
  end
  local __s = ${current}
  for _=1,${layers+3} do
    local r,isStr = ${runFunName}(__s)
    if not r then
      ${safeMode ? "-- safe mode: continue anyway" : "break"}
      if not ${safeMode} then break end
    end
    if isStr then
      __s = r
    else
      if r then return end
    end
  end
  local ok2,f2 = pcall(loadstring,__s)
  if ok2 and type(f2)=="function" then pcall(f2) end
end)()
  `;
  if(oneLine) finalLua = finalLua.replace(/\s+/g," ").trim();
  return finalLua;
}

const inputArea=document.getElementById("inputArea");
const outArea=document.getElementById("outArea");
document.getElementById("obfBtn").addEventListener("click",()=>{
  const src=inputArea.value||"";
  if(!src.trim()){alert("Paste some Luau code first!");return;}
  const layers=parseInt(document.getElementById("layerCount").value,10)||3;
  const oneLine=document.getElementById("oneLineChk").checked;
  const compactInner=document.getElementById("compactInner").checked;
  const safeMode=document.getElementById("safeModeChk").checked;
  try{
    const out=generateObfuscated(src,layers,oneLine,compactInner,safeMode);
    outArea.textContent=out;
  }catch(e){
    outArea.textContent="-- error generating: "+e.message;
  }
});
document.getElementById("exampleBtn").addEventListener("click",()=>{
  inputArea.value=`-- example script
for i=1,3 do
  print("diamond", i)
end`;
});
document.getElementById("copyBtn").addEventListener("click",()=>{
  if(!outArea.textContent)return alert("Nothing to copy");
  navigator.clipboard.writeText(outArea.textContent).then(()=>alert("Copied!"));
});
document.getElementById("downloadBtn").addEventListener("click",()=>{
  if(!outArea.textContent)return alert("Nothing to download");
  const name=`diamond_obf_${Date.now()}.lua`;
  const blob=new Blob([outArea.textContent],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name;
  document.body.appendChild(a);a.click();a.remove();
  setTimeout(()=>URL.revokeObjectURL(a.href),5000);
});
</script>
</body>
</html>
